openapi: 3.0.0

info:
  version: "1.0"
  title: "Trade-a-Bid"
  description: "Web Resources Specification (A7) for Trade-a-Bid"

servers:
  # Added by API Auto Mocking Plugin
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/lbaw2112/Trade-a-Bid/1.0
  - url: http://lbaw2112-piu.lbaw-prod.fe.up.pt/
    description: "Production server"

externalDocs:
  description: "Find more info here."
  url: https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/eap

tags:
  - name: "M01: Authentication and Individual Profile"
  - name: "M02: Auctions"
  - name: "M03: Users"
  - name: "M04: User Administration and Static pages"

paths:
  # M01: Authentication and Individual Profile
  /login:
    get:
      operationId: R101
      summary: "R101: Login Form"
      description: "Provide login form. Access: PUB"
      tags:
        - "M01: Authentication and Individual Profile"
      responses:
        "200":
          description: "Ok. Show [UI04 Sign-in](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui04-sign-in)"
    post:
      operationId: R102
      summary: "R102: Login Action"
      description: "Processes the login form submission. Access: PUB"
      tags:
        - "M01: Authentication and Individual Profile"
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
              required:
                - email
                - password
      responses:
        "302":
          description: "Redirect after processing the login credentials."
          headers:
            location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Successful authentication, redirecting to home page"
                  value: "/"
                302Error:
                  description: "Failed to authenticate. Returning to login form"
                  value: "/login"

  /logout:
    post:
      operationId: R103
      summary: "R103: Sign-out"
      description: "Sign-out the current authenticated user. Access: USR, ADM"
      tags:
        - "M01: Authentication and Individual Profile"
      responses:
        "302":
          description: "Redict after processing sign-out"
          headers:
            location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Sign-out successful. Redirecting to home page"
                  value: "/"

  /register:
    get:
      operationId: R104
      summary: "R104: Register Form"
      description: "Provide a new user registration form. Access: PUB"
      tags:
        - "M01: Authentication and Individual Profile"
      responses:
        "200":
          description: "Ok. Show [UI05 Sign-up](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui05-sign-up)"

    post:
      operationId: R105
      summary: "R105: Register new user"
      description: "Processes the form information to register new user. Access: PUB"
      tags:
        - "M01: Authentication and Individual Profile"

      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                name:
                  type: string
                username:
                  type: string
                email:
                  type: string
                  format: email
                phone:
                  type: string
                  format: phone
                password:
                  type: string
                  format: password
                confirmationPassword:
                  type: string
                  format: password
                termsService:
                  type: boolean
              required:
                - name
                - username
                - email
                - phone
                - password
                - confirmationPassword
                - termsService

      responses:
        "302":
          description: "Redirect after processing new user information"
          headers:
            location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Sucessful registration. Redirecting to home page"
                  value: "/"
                302Error:
                  description: "Failed registration. Redirecting back to register form"
                  value: "/register"

  /users/me:
    get:
      operationId: R106
      summary: "R106: View your profile"
      description: "Show user profile Access: USR"
      tags:
        - "M01: Authentication and Individual Profile"
      responses:
        "200":
          description: "Ok. Show [UI04 Sign-in](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui10-public-profile)"

  /user/settings_account:
    get:
      operationId: R107
      summary: "R107: Edit user profile"
      description: "Provide a form with the user's data to be edited. Access: USR"
      tags:
        - "M01: Authentication and Individual Profile"
      responses:
        "200":
          description: "Ok. Show [UI04 Sign-in](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui11-settings)"

    post:
      operationId: R108
      summary: "R108: Edit user profile"
      description: "Processes the form information to update user information. Acess: USR"
      tags:
        - "M01: Authentication and Individual Profile"
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                name:
                  type: string
                username:
                  type: string
                email:
                  type: string
                  format: email
                image:
                  type: string
                  format: binary
      responses:
        "302":
          description: 'Redirect after processing new account settings.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Account settings saved. Redirect to profile page."
                  value: "/user/{id}"
                302Failure:
                  description: "Couldn't save settings. Redirect to settings page."
                  value: "/user/settings_account"

  /user/settings_account/delete:
    post:
      operationId: R113
      summary: "R113: Delete account"
      description: "Deletes all your personal information and account"
      responses:
        "302":
          description: 'Redirect after processing account deletion.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Account deleted. Redirect to home page."
                  value: "/"
                302Failure:
                  description: "Couldn't delete account. Redirect to settings page."
                  value: "/user/settings_account"

  /user/settings_privacy:
    get:
      operationId: R109
      summary: "R109: Edit privacy settings"
      description: "Provide a form with the user's privacy settings to be edited. Access: USR"
      tags:
        - "M01: Authentication and Individual Profile"
      responses:
        "200":
          description: "Ok. Show [UI04 Sign-in](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui11-settings)"

    post:
      operationId: R110
      summary: "R110: Edit privacy settings"
      description: "Processes the form information to update user information. Acess: USR"
      tags:
        - "M01: Authentication and Individual Profile"
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                switch-nsf:
                  type: boolean
                switch-use-data:
                  type: boolean
                email:
                  type: string
                switch-notifications:
                  type: boolean
                switch-outbid-notifications:
                  type: boolean
                switch-start-auction-notifications:
                  type: boolean
                switch-user-activity-notifications:
                  type: boolean
      responses:
        "302":
          description: 'Redirect after processing privacy settings.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Privacy settings saved. Redirect to profile page."
                  value: "/user/{id}"
                302Failure:
                  description: "Couldn't save privacy settings. Redirect to profile page."
                  value: "/user/{id}"

  /user/settings_security:
    get:
      operationId: R111
      summary: "R111: Edit security settings"
      description: "Provide a form with passwords fields to be edited. Access: USR"
      tags:
        - "M01: Authentication and Individual Profile"
      responses:
        "200":
          description: "Ok. Show [UI04 Sign-in](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui11-settings)"

    post:
      operationId: R112
      summary: "R112: Edit security settings"
      description: "Processes the form information to update user's password. Acess: USR"
      tags:
        - "M01: Authentication and Individual Profile"
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                pwd:
                  type: string
                  format: password
                pwd-new:
                  type: string
                  format: password
                pwd-confirmed:
                  type: string
                  format: passowrd
      responses:
        "302":
          description: 'Redirect after processing security changes.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Security settings saved. Redirect to profile page."
                  value: "/user/{id}"
                302Failure:
                  description: "Couldn't save security settings. Redirect to profile page."
                  value: "/user/{id}"

  # M02: Auctions

  /auction/create_auction:
    get:
      operationId: R201
      summary: "R201: Create auction form"
      description: "Provide a new auction registration form. Access: USR"
      tags:
        - "M02: Auctions"
      responses:
        "200":
          description: "Ok. Show [UI08 Create Auction](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui08-create-auction)"

    post:
      operationId: R202
      summary: "R202: Create an auction"
      description: "Processes the form information to create an auction. Access: USR"
      tags:
        - "M02: Auctions"

      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                startDate:
                  type: string
                  format: date
                startTime:
                  type: string
                  format: time
                endDate:
                  type: string
                  format: date
                endTime:
                  type: string
                  format: time
                startingBid:
                  type: number
                increment:
                  type: number
                isPercentual:
                  type: boolean
                category:
                  type: string
                nsfw:
                  type: boolean
                images:
                  type: array
                  items:
                    type: string
                    format: binary
              required:
                - name
                - description
                - startDate
                - startTime
                - endDate
                - endTime
                - startingBid
                - increment
                - isPercentual
                - category
                - nsfw
                - images

      responses:
        "302":
          description: 'Redirect after processing the new auction information.'
          headers:
            Location:
              schema:
                type: string
              examples:
                302Success:
                  description: "Auction created successfully. Redirect to auction page."
                  value: "/auctions/{id}"
                302Failure:
                  description: "Auction couldn't be created. Redirect to create auction form."
                  value: "/auctions/create_auction"

  /auction/{id}:
    get:
      operationId: R203
      summary: "R203: View an auction"
      description: "Show auction page. Access: PUB"
      tags:
        - "M02: Auctions"
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        "200":
          description: "Ok. Show [UI07 Auction](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui07-auction)"

  /auction/search_results:
    get:
      operationId: R204
      summary: "R204: Search Auctions"
      description: "Searches for auctions and returns the search results as JSON. Access: PUB"
      tags:
        - "M02: Auctions"
      parameters:
        - in: query
          name: category
          description: "Categories to search for"
          schema:
            type: array
            items:
              type: string
          required: false
        - in: query
          name: min_bid_value
          description: "Minimum value for the current bid of an auction"
          schema:
            type: number
            format: money
          required: false
        - in: query
          name: max_bid_value
          description: "Maximum value for the current bid of an auction"
          schema:
            type: number
            format: money
          required: false
        - in: query
          name: followed_users
          description: "Boolean with the flag to search for followed users"
          schema:
            type: boolean
          required: false
        - in: query
          name: status
          description: "Specific auction status, i.e. Open and/or Scheduled auctions"
          schema:
            type: array
            items:
              type: string
          required: false
        - in: query
          name: username
          description: "Search for specific usernames"
          schema:
            type: string
          required: false
        - in: query
          name: search_text
          description: "String to use for full-text search"
          schema:
            type: string
          required: false
      responses:
        "200":
          description: "Success"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    title:
                      type: string
                    seller:
                      type: string
                    current_bid:
                      type: number
                      format: money
                    personal_bid:
                      type: number
                      format: money
                    start_date:
                      type: string
                      format: date
                    end_date:
                      type: string
                      format: date
                    bookmarked:
                      type: boolean
                    thumb_image:
                      type: string
                      format: binary
                    status:
                      type: string
              example:
                - id: 1
                  title: "Foo Fighters - Greatest Hits MP3"
                  seller: "ffighters"
                  current_bid: 125.3
                  personal_bid: 123.59
                  start_date: "2021-03-13 12:00:00"
                  end_date: "2021-03-27 12:00:00"
                  bookmarked: true
                  thumb_image: image
                  status: "Open"
                - id: 6
                  title: "Fighters Legacy - STEAM KEY"
                  seller: "ppenguin"
                  current_bid: 103.03
                  personal_bid: null
                  start_date: "2021-02-12 12:00:00"
                  end_date: "2021-03-20 12:00:00"
                  bookmarked: false
                  thumb_image: image
                  status: "Open"

  /auction/{id}/delete:
    get:
      operationId: R205
      summary: "R205: Delete an auction"
      description: "Set specified auction as 'Terminated'. Access: USR"
      tags:
        - "M02: Auctions"
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        "200":
          description: "Ok. Show [UI09 Dashboard](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui09-dashboard)"


  # M03: Users
  /users/{username}:
    get:
      operationId: R301
      summary: "R301: User profile"
      description: "Shows a user profile. Access: PUB"
      tags:
        - "M03: Users"
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
      responses:
        "200":
          description: "Ok. Show [UI10 Public Profile](https://git.fe.up.pt/lbaw/lbaw2021/lbaw2112/-/wikis/er#ui10-public-profile)"

  /users/search_results:
    get:
      operationId: R302
      summary: "R302: Search Users"
      description: "Searches for users and returns the search results as JSON. Access: PUB"
      tags:
        - "M03: Users"
      parameters:
        - in: query
          name: has_auctions           # TODO maybe add more options?
          description: "Search only for users who have auctions"
          schema:
            type: boolean
          required: false
        - in: query
          name: followed_users
          description: "Boolean indicating if only followed users should be displayed"
          schema:
            type: boolean
          required: false
        - in: query
          name: min_rating
          description: "Minimum value for a user's rating"
          schema:
            type: integer
          required: false
        - in: query
          name: max_rating
          description: "Maximum value for a user's rating"
          schema:
            type: integer
          required: false
        - in: query
          name: min_register_date
          description: "Minimum account creation date"
          schema:
            type: string
            format: date
          required: false
        - in: query
          name: max_register_date
          description: "Maximum account creation date"
          schema:
            type: string
            format: date
          required: false
        - in: query
          name: search_text
          description: "String to use for full-text search"
          schema:
            type: string
          required: false
      responses:
        "200":
          description: "Success"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    username:
                      type: string
                    profile_image:
                      type: string
                      format: binary
                    joined:
                      type: string
                      format: date
                    followed:
                      type: boolean
                    rating:
                      type: integer
              example:
                - id: 4
                  name: "Old Monk"
                  username: "old_monk"
                  profile_image: image
                  joined: "2021-04-15 16:00:00"
                  followed: true
                  rating: 56
                - id: 9
                  name: "Farm Worker"
                  username: "ppenguin"
                  profile_image: image
                  joined: "2021-03-01 15:30:00"
                  followed: false
                  rating: 343

  # M04  User Administration and Static pages
  /admin/user_management:
    get:
      operationId: R401
      summary: "R303: Manage banned users"
      description: "Displays banned users to be managed by an administrator. Access: ADM"
      tags:
        - "M04: User Administration and Static pages"
      responses:
        "200":
          description: "Success"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    username:
                      type: string
                    permissions:   # boolean?
                      type: array
                      items:
                        type: boolean
                    reason:
                      type: string
                      format: category
                    joined:
                      type: string
                      format: date
              example:
                - id: 5
                  username: "markhamill"
                  permissions:
                    - true
                    - false
                    - false
                  reason: "Fraudulent Behaviour"
                  joined: "2021-04-15 16:00:00"
                - id: 7
                  username: "johndoe"
                  permissions:
                    - false
                    - false
                    - true
                  reason: "Fraudulent Behaviour"
                  joined: "2021-04-15 17:00:00"

  /admin/reported_users:
    get:
      operationId: R402
      summary: "R402: View reported users"
      description: "Displays all reported users. Access: ADM"
      tags:
        - "M04: User Administration and Static pages"
      responses:
        "200":
          description: "Success"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    username:
                      type: string
                    reason:
                      type: string
                      format: category
                    details:
                      type: string
                    date:
                      type: string
                      format: date
              example:
                - id: 5
                  username: "markhamill"
                  reason: "Fraudulent Behaviour"
                  details: "Improper username"
                  date: "2021-02-12 17:00:00"
                - id: 7
                  username: "johndoe"
                  reason: "Fraudulent Behaviour"
                  details: "Improper profile image"
                  date: "2021-04-15 18:00:00"

  /admin/auction_management:
    get:
      operationId: R403
      summary: "R403: Manage reported auctions"
      description: "Displays all auctions to be managed by an administrator. Access: ADM"
      tags:
        - "M04: User Administration and Static pages"
      responses:
        "200":
          description: "Success"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    title:
                      type: string
                    status:         # boolean?
                      type: array
                      items:
                        type: boolean
                    details:
                      type: string
                    start_date:
                      type: string
                      format: date
                    end_date:
                      type: string
                      format: date
              example:
                - id: 5
                  title: "Siksong Steam Key"
                  status:
                    - true
                    - false
                    - false
                    - false
                  details: "Attempt to sell unreleased game"
                  start_date: "2021-02-12 17:00:00"
                  end_date: "2021-02-14 17:00:00"
                - id: 7
                  title: "Hades Steam Key"
                  status:
                    - false
                    - true
                    - false
                    - false
                  details: "Using images from other games"
                  start_date: "2021-02-14 12:00:00"
                  end_date: "2021-02-15 12:00:00"

  /admin/reported_auctions:
    get:
      operationId: R404
      summary: "R404: View all reported auctions"
      description: "Displays all auction reports. Access: ADM"
      tags:
        - "M04: User Administration and Static pages"
      responses:
        "200":
          description: "Success"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    title:
                      type: string
                    reason:
                      type: string
                      format: category
                    details:
                      type: string
                    date:
                      type: string
                      format: date
              example:
                - id: 5
                  title: "Siksong Steam Key"
                  reason: "Fraudulent Behaviour"
                  details: "Attempt to sell unreleased game"
                  date: "2021-02-12 17:00:00"
                - id: 4
                  title: "Hades Steam Key"
                  reason: "Improper auction pictures"
                  details: "Using images from other games"
                  date: "2021-02-15 12:00:00"